<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Malla Interactiva - Medicina Veterinaria</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f5f5f5;
      padding: 20px;
    }
    h1 {
      text-align: center;
    }
    .buttons {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin: 20px 0;
    }
    button {
      padding: 8px 16px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      background-color: #1976d2;
      color: white;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(11, 1fr);
      gap: 10px;
      margin-top: 20px;
    }
    .semestre {
      background-color: #eee;
      border-radius: 10px;
      padding: 10px;
    }
    .semestre h2 {
      font-size: 1.1rem;
      margin: 0 0 10px;
      text-align: center;
    }
    .ramo {
      background-color: #ffffff;
      border-left: 5px solid #ccc;
      padding: 8px;
      border-radius: 5px;
      margin-bottom: 5px;
      cursor: pointer;
    }
    .ramo.aprobado {
      background-color: #c3f3c3;
      text-decoration: line-through;
    }
    .ramo.bloqueado {
      opacity: 0.5;
      pointer-events: none;
    }
    .s1 { background-color: #fce4ec; }
    .s2 { background-color: #e3f2fd; }
    .s3 { background-color: #e8f5e9; }
  </style>
</head>
<body>
  <h1>Malla Interactiva - Medicina Veterinaria</h1>
  <div class="buttons">
    <button onclick="limpiarProgreso()">Limpiar progreso</button>
    <button onclick="exportarProgreso()">Exportar avance</button>
    <button onclick="document.getElementById('fileInput').click()">Importar avance</button>
    <input id="fileInput" type="file" style="display:none" onchange="importarProgreso(event)" />
  </div>
  <div class="grid" id="malla"></div>
  <script>
    const malla = /* aquí va el contenido de la malla (ramos y semestres) que ya tienes */;

    const completados = new Set(JSON.parse(localStorage.getItem("aprobados")) || []);

    function desbloqueado(codigo) {
      return malla.every(sem => sem.ramos.every(r =>
        !r.desbloquea?.includes(codigo) || completados.has(r.codigo)
      ));
    }

    function renderMalla() {
      const container = document.getElementById("malla");
      container.innerHTML = "";
      malla.forEach(s => {
        const semDiv = document.createElement("div");
        semDiv.className = `semestre ${s.color}`;
        const titulo = document.createElement("h2");
        titulo.textContent = `Semestre ${s.semestre}`;
        semDiv.appendChild(titulo);
        s.ramos.forEach(r => {
          const ramoDiv = document.createElement("div");
          ramoDiv.className = "ramo";
          ramoDiv.textContent = r.nombre;
          ramoDiv.dataset.codigo = r.codigo;
          if (!completados.has(r.codigo) && !desbloqueado(r.codigo)) ramoDiv.classList.add("bloqueado");
          if (completados.has(r.codigo)) ramoDiv.classList.add("aprobado");
          ramoDiv.onclick = () => {
            if (completados.has(r.codigo)) {
              completados.delete(r.codigo);
            } else {
              completados.add(r.codigo);
            }
            localStorage.setItem("aprobados", JSON.stringify([...completados]));
            renderMalla();
          };
          semDiv.appendChild(ramoDiv);
        });
        container.appendChild(semDiv);
      });
    }

    function limpiarProgreso() {
      if (confirm("¿Estás segura que deseas borrar tu progreso?")) {
        localStorage.removeItem("aprobados");
        location.reload();
      }
    }

    function exportarProgreso() {
      const data = JSON.stringify([...completados]);
      const blob = new Blob([data], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "progreso-veterinaria.json";
      a.click();
    }

    function importarProgreso(event) {
      const file = event.target.files[0];
      const reader = new FileReader();
      reader.onload = e => {
        const data = JSON.parse(e.target.result);
        localStorage.setItem("aprobados", JSON.stringify(data));
        location.reload();
      };
      reader.readAsText(file);
    }

    renderMalla();
  </script>
</body>
</html>
